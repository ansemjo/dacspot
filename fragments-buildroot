# write new defconfig to a different file
BR2_DEFCONFIG="$(CONFIG_DIR)/configs/dacspot_defconfig"

# ----- general build optimizations ----- #

# use a build cache
BR2_CCACHE=y

# link-time optimizations and prioritize speed over size
BR2_ENABLE_LTO=y
BR2_OPTIMIZE_2=y

# ----- system settings ----- #

# zstd-compressed kernel
BR2_LINUX_KERNEL_ZSTD=y

# symlinked /usr
BR2_ROOTFS_MERGED_USR=y

# set hostname and banner
BR2_TARGET_GENERIC_HOSTNAME="dacspot"
BR2_TARGET_GENERIC_ISSUE="Welcome to DACspot Buildroot"

# ensure we use the simplest init system
BR2_INIT_BUSYBOX=y
BR2_ROOTFS_DEVICE_CREATION_DYNAMIC_DEVTMPFS=y

# generate a readonly squashfs rootfs and disable ext4
# BR2_TARGET_GENERIC_REMOUNT_ROOTFS_RW is not set
BR2_TARGET_ROOTFS_SQUASHFS=y
BR2_TARGET_ROOTFS_SQUASHFS4_GZIP=y
# BR2_TARGET_ROOTFS_EXT2 is not set

# generate timezone data
BR2_TARGET_TZ_INFO=y
BR2_TARGET_LOCALTIME="Europe/Berlin"

# tweaks for included kernel
BR2_LINUX_KERNEL_CONFIG_FRAGMENT_FILES="../fragments-linux"

# stronger security hardening
#BR2_SSP_ALL=y
#BR2_SSP_OPTION="-fstack-protector-all"
#BR2_RELRO_FULL=y
#BR2_FORTIFY_SOURCE_2=y

# include our own rootfs tree
BR2_ROOTFS_OVERLAY="../tree/"

# use custom hook scripts
BR2_ROOTFS_POST_BUILD_SCRIPT="../post-build.sh"
BR2_ROOTFS_POST_IMAGE_SCRIPT="../post-image.sh"

# use a custom config.txt for raspberry firmware
BR2_PACKAGE_RPI_FIRMWARE_CONFIG_FILE="../config.txt"

# ----- package selection ----- #

# necessary firmware for wifi
BR2_PACKAGE_BRCMFMAC_SDIO_FIRMWARE_RPI=y
BR2_PACKAGE_BRCMFMAC_SDIO_FIRMWARE_RPI_BT=y
BR2_PACKAGE_BRCMFMAC_SDIO_FIRMWARE_RPI_WIFI=y

# wireless tools
BR2_PACKAGE_CRDA=y
BR2_PACKAGE_IFUPDOWN_SCRIPTS=y
BR2_PACKAGE_IW=y
BR2_PACKAGE_WIRELESS_REGDB=y
BR2_PACKAGE_WIRELESS_TOOLS=y

# wpa_supplicant
BR2_PACKAGE_WPA_SUPPLICANT=y
BR2_PACKAGE_WPA_SUPPLICANT_NL80211=y

# ntp daemon
BR2_PACKAGE_NTP=y
BR2_PACKAGE_NTP_NTPD=y
BR2_PACKAGE_NTP_NTPDATE=y
